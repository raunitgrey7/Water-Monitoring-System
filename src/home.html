<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Vinit Shahdeo" />
    <link
      href="https://www.jqueryscript.net/css/jquerysctipttop.css"
      rel="stylesheet"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat:400,500,600,700"
      rel="stylesheet"
    />
    <title>Water Level Monitoring System - IoT Project</title>
    <style>
      :root {
        --primary: #1a6fc4;
        --secondary: #21b3b9;
        --danger: #fe5e21;
        --warning: #ffb30c;
        --success: #2ed351;
        --dark: #2c3e50;
        --light: #f8f9fa;
      }
      
      body {
        background-color: var(--light);
        font-family: "Montserrat", sans-serif;
        color: #333;
        overflow-x: hidden;
      }

      .container {
        margin: 80px auto;
        max-width: 1200px;
      }

      .header-section {
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        color: white;
        padding: 40px 0;
        border-radius: 10px;
        margin-bottom: 40px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .header-section h1 {
        font-weight: 700;
        margin-bottom: 20px;
      }

      .header-section p {
        font-size: 16px;
        max-width: 800px;
        margin: 0 auto;
        line-height: 1.6;
      }

      .tank-container {
        margin-bottom: 50px;
      }

      .tank-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        transition: transform 0.3s ease;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .tank-card:hover {
        transform: translateY(-5px);
      }

      .tank-card.alarm-active {
        animation: pulse-alarm 2s infinite;
        border: 2px solid var(--danger);
      }

      @keyframes pulse-alarm {
        0% { box-shadow: 0 0 0 0 rgba(254, 94, 33, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(254, 94, 33, 0); }
        100% { box-shadow: 0 0 0 0 rgba(254, 94, 33, 0); }
      }

      .tank-title {
        font-weight: 600;
        margin-bottom: 15px;
        color: var(--primary);
      }

      .tank-display {
        width: 180px;
        height: 180px;
        margin: 0 auto 15px;
      }

      .alarm-controls {
        margin-top: 15px;
        padding: 10px;
        background-color: #f8f9fa;
        border-radius: 5px;
      }

      .alarm-threshold {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 10px;
      }

      .alarm-threshold label {
        margin-right: 10px;
        font-size: 14px;
      }

      .alarm-threshold input {
        width: 60px;
        text-align: center;
      }

      .alarm-btn {
        background-color: var(--danger);
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        transition: background-color 0.3s;
      }

      .alarm-btn:hover {
        background-color: #e04e1b;
      }

      .alarm-btn.muted {
        background-color: #6c757d;
      }

      .status-zones {
        margin: 40px 0;
      }

      .zone {
        padding: 25px 15px;
        text-align: center;
        border-radius: 8px;
        color: white;
        font-weight: 600;
      }

      .danger-zone {
        background-color: var(--danger);
      }

      .warning-zone {
        background-color: var(--warning);
      }

      .safe-zone {
        background-color: var(--success);
      }

      footer {
        background-color: var(--dark);
        color: white;
        padding: 40px 0 20px;
        margin-top: 50px;
      }

      .footer-heading {
        font-weight: 600;
        margin-bottom: 20px;
        color: #1abc9c;
      }

      .footer-links {
        list-style: none;
        padding: 0;
      }

      .footer-links li {
        margin-bottom: 10px;
      }

      .footer-links a {
        color: #ecf0f1;
        text-decoration: none;
        transition: color 0.3s;
      }

      .footer-links a:hover {
        color: #1abc9c;
      }

      .social-icons {
        margin-top: 20px;
      }

      .social-icons a {
        display: inline-block;
        width: 40px;
        height: 40px;
        background-color: #34495e;
        color: white;
        border-radius: 50%;
        text-align: center;
        line-height: 40px;
        margin-right: 10px;
        transition: background-color 0.3s;
      }

      .social-icons a:hover {
        background-color: #1abc9c;
      }

      .copyright {
        text-align: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #34495e;
        color: #bdc3c7;
        font-size: 14px;
      }

      /* Admin Dashboard Styles */
      .admin-container {
        display: none;
        margin-top: 20px;
      }

      .admin-header {
        background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        color: white;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .admin-panel {
        background: white;
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      .admin-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        text-align: center;
        border-left: 4px solid var(--primary);
      }

      .stat-card.danger {
        border-left-color: var(--danger);
      }

      .stat-card.warning {
        border-left-color: var(--warning);
      }

      .stat-card.success {
        border-left-color: var(--success);
      }

      .stat-value {
        font-size: 28px;
        font-weight: 700;
        margin: 10px 0;
      }

      .stat-label {
        font-size: 14px;
        color: #6c757d;
      }

      .admin-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      .admin-table th,
      .admin-table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #e9ecef;
      }

      .admin-table th {
        background-color: #f8f9fa;
        font-weight: 600;
        color: var(--dark);
      }

      .admin-table tr:hover {
        background-color: #f8f9fa;
      }

      .status-badge {
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
      }

      .status-badge.danger {
        background-color: rgba(254, 94, 33, 0.1);
        color: var(--danger);
      }

      .status-badge.warning {
        background-color: rgba(255, 179, 12, 0.1);
        color: var(--warning);
      }

      .status-badge.success {
        background-color: rgba(46, 211, 81, 0.1);
        color: var(--success);
      }

      .login-container {
        max-width: 400px;
        margin: 100px auto;
        padding: 30px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .login-header {
        text-align: center;
        margin-bottom: 30px;
      }

      .login-header h2 {
        color: var(--primary);
        font-weight: 700;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-control {
        border-radius: 5px;
        padding: 12px 15px;
        border: 1px solid #e1e5e9;
        transition: border-color 0.3s;
      }

      .form-control:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 0.2rem rgba(26, 111, 196, 0.25);
      }

      .btn-primary {
        background-color: var(--primary);
        border-color: var(--primary);
        padding: 12px 20px;
        font-weight: 600;
        border-radius: 5px;
        transition: background-color 0.3s;
      }

      .btn-primary:hover {
        background-color: #155a9f;
        border-color: #155a9f;
      }

      .btn-logout {
        background-color: var(--danger);
        border-color: var(--danger);
        color: white;
      }

      .btn-logout:hover {
        background-color: #e04e1b;
        border-color: #e04e1b;
      }

      .nav-tabs {
        border-bottom: 2px solid #e9ecef;
        margin-bottom: 20px;
      }

      .nav-tabs .nav-link {
        border: none;
        color: #6c757d;
        font-weight: 600;
        padding: 12px 20px;
        border-radius: 5px 5px 0 0;
      }

      .nav-tabs .nav-link.active {
        color: var(--primary);
        background-color: white;
        border-bottom: 3px solid var(--primary);
      }

      .chart-container {
        height: 300px;
        margin-bottom: 30px;
      }

      .alarm-active-indicator {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 12px;
        height: 12px;
        background-color: var(--danger);
        border-radius: 50%;
        animation: blink 1s infinite;
      }

      @keyframes blink {
        0% { opacity: 1; }
        50% { opacity: 0.3; }
        100% { opacity: 1; }
      }

      @media (max-width: 768px) {
        .tank-card {
          margin-bottom: 20px;
        }
        
        .zone {
          margin-bottom: 15px;
        }
        
        .admin-stats {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>

  <body>
    <!-- Login Form -->
    <div id="loginForm" class="login-container">
      <div class="login-header">
        <h2><i class="fas fa-tint"></i> Water Monitoring System</h2>
        <p>Admin Dashboard Login</p>
      </div>
      <form id="loginFormElement">
        <div class="form-group">
          <label for="username">Username</label>
          <input type="text" class="form-control" id="username" placeholder="Enter username" required>
        </div>
        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" class="form-control" id="password" placeholder="Enter password" required>
        </div>
        <button type="submit" class="btn btn-primary btn-block">Login</button>
      </form>
      <div class="text-center mt-3">
        <a href="#" id="showPublic">View Public Dashboard</a>
      </div>
    </div>

    <!-- Public Dashboard -->
    <div id="publicDashboard" class="container">
      <div class="header-section">
        <div class="row">
          <div class="col-md-8 col-md-offset-2 text-center">
            <h1>Water Monitoring System</h1>
            <p>
              Water Monitoring System is an IoT-based Liquid Level Monitoring system
              that has mechanisms to keep the user alerted in case of liquid
              overflow or when tank depletes. The system provides real-time
              monitoring of multiple tanks with visual indicators for different
              water levels.
            </p>
            <button id="showAdminLogin" class="btn btn-light mt-3">
              <i class="fas fa-user-shield"></i> Admin Login
            </button>
          </div>
        </div>
      </div>

      <div class="tank-container">
        <div class="row">
          <div class="col-md-3 col-sm-6">
            <div class="tank-card" id="tank1-card">
              <h3 class="tank-title">Tank 1</h3>
              <div class="tank-display tank1"></div>
              <div class="tank-status" id="status1">Loading...</div>
              <div class="alarm-controls">
                <div class="alarm-threshold">
                  <label>Alarm at:</label>
                  <input type="number" id="threshold1" min="0" max="100" value="90">
                  <span>%</span>
                </div>
                <button class="alarm-btn" id="alarmBtn1">Enable Alarm</button>
              </div>
            </div>
          </div>
          <div class="col-md-3 col-sm-6">
            <div class="tank-card" id="tank2-card">
              <h3 class="tank-title">Tank 2</h3>
              <div class="tank-display tank2"></div>
              <div class="tank-status" id="status2">Loading...</div>
              <div class="alarm-controls">
                <div class="alarm-threshold">
                  <label>Alarm at:</label>
                  <input type="number" id="threshold2" min="0" max="100" value="90">
                  <span>%</span>
                </div>
                <button class="alarm-btn" id="alarmBtn2">Enable Alarm</button>
              </div>
            </div>
          </div>
          <div class="col-md-3 col-sm-6">
            <div class="tank-card" id="tank3-card">
              <h3 class="tank-title">Tank 3</h3>
              <div class="tank-display tank3"></div>
              <div class="tank-status" id="status3">Loading...</div>
              <div class="alarm-controls">
                <div class="alarm-threshold">
                  <label>Alarm at:</label>
                  <input type="number" id="threshold3" min="0" max="100" value="90">
                  <span>%</span>
                </div>
                <button class="alarm-btn" id="alarmBtn3">Enable Alarm</button>
              </div>
            </div>
          </div>
          <div class="col-md-3 col-sm-6">
            <div class="tank-card" id="tank4-card">
              <h3 class="tank-title">Tank 4</h3>
              <div class="tank-display tank4"></div>
              <div class="tank-status" id="status4">Loading...</div>
              <div class="alarm-controls">
                <div class="alarm-threshold">
                  <label>Alarm at:</label>
                  <input type="number" id="threshold4" min="0" max="100" value="90">
                  <span>%</span>
                </div>
                <button class="alarm-btn" id="alarmBtn4">Enable Alarm</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="status-zones">
        <div class="row">
          <div class="col-md-4">
            <div class="zone danger-zone">
              <h3>Danger Zone</h3>
              <p>Water level below 20%</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="zone warning-zone">
              <h3>Warning Zone</h3>
              <p>Water level between 20% - 40%</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="zone safe-zone">
              <h3>Safe Zone</h3>
              <p>Water level above 40%</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="container admin-container">
      <div class="admin-header">
        <h2><i class="fas fa-tachometer-alt"></i> Admin Dashboard</h2>
        <button id="logoutBtn" class="btn btn-logout">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>

      <div class="admin-stats">
        <div class="stat-card">
          <div class="stat-label">Total Tanks</div>
          <div class="stat-value">4</div>
          <div class="stat-desc">Monitored</div>
        </div>
        <div class="stat-card success">
          <div class="stat-label">Safe Tanks</div>
          <div class="stat-value" id="safeTanks">2</div>
          <div class="stat-desc">Above 40%</div>
        </div>
        <div class="stat-card warning">
          <div class="stat-label">Warning Tanks</div>
          <div class="stat-value" id="warningTanks">1</div>
          <div class="stat-desc">20% - 40%</div>
        </div>
        <div class="stat-card danger">
          <div class="stat-label">Critical Tanks</div>
          <div class="stat-value" id="criticalTanks">1</div>
          <div class="stat-desc">Below 20%</div>
        </div>
      </div>

      <div class="admin-panel">
        <h3><i class="fas fa-list"></i> Tank Status Overview</h3>
        <table class="admin-table">
          <thead>
            <tr>
              <th>Tank ID</th>
              <th>Name</th>
              <th>Water Level</th>
              <th>Status</th>
              <th>Alarm</th>
              <th>Last Updated</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>#T001</td>
              <td>Tank 1</td>
              <td id="adminTank1Level">45%</td>
              <td><span class="status-badge success" id="adminTank1Status">Safe</span></td>
              <td id="adminTank1Alarm">Disabled</td>
              <td id="adminTank1Time">Just now</td>
            </tr>
            <tr>
              <td>#T002</td>
              <td>Tank 2</td>
              <td id="adminTank2Level">65%</td>
              <td><span class="status-badge success" id="adminTank2Status">Safe</span></td>
              <td id="adminTank2Alarm">Disabled</td>
              <td id="adminTank2Time">Just now</td>
            </tr>
            <tr>
              <td>#T003</td>
              <td>Tank 3</td>
              <td id="adminTank3Level">25%</td>
              <td><span class="status-badge warning" id="adminTank3Status">Warning</span></td>
              <td id="adminTank3Alarm">Disabled</td>
              <td id="adminTank3Time">Just now</td>
            </tr>
            <tr>
              <td>#T004</td>
              <td>Tank 4</td>
              <td id="adminTank4Level">85%</td>
              <td><span class="status-badge success" id="adminTank4Status">Safe</span></td>
              <td id="adminTank4Alarm">Disabled</td>
              <td id="adminTank4Time">Just now</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="admin-panel">
        <h3><i class="fas fa-chart-line"></i> Water Level Trends</h3>
        <div class="chart-container">
          <canvas id="waterLevelChart"></canvas>
        </div>
      </div>
    </div>

    <footer id="mainFooter">
      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <h4 class="footer-heading">About the Project</h4>
            <p>This IoT-based Water Monitoring System helps in efficient water management by providing real-time monitoring of water levels in multiple tanks.</p>
          </div>
          <div class="col-md-4">
            <h4 class="footer-heading">Quick Links</h4>
            <ul class="footer-links">
              <li><a href="#"><i class="fas fa-home"></i> Home</a></li>
              <li><a href="#"><i class="fas fa-info-circle"></i> About</a></li>
              <li><a href="#"><i class="fas fa-book"></i> Documentation</a></li>
              <li><a href="#"><i class="fas fa-envelope"></i> Contact</a></li>
            </ul>
          </div>
          <div class="col-md-4">
            <h4 class="footer-heading">Connect With Us</h4>
            <div class="social-icons">
              <a href="#"><i class="fab fa-facebook-f"></i></a>
              <a href="#"><i class="fab fa-twitter"></i></a>
              <a href="#"><i class="fab fa-linkedin-in"></i></a>
              <a href="#"><i class="fab fa-github"></i></a>
            </div>
          </div>
        </div>
        <div class="copyright">
          <p>&copy; 2023 Water Monitoring System. Made by Vinit Shahdeo</p>
        </div>
      </div>
    </footer>

    <!-- Alarm Sound -->
    <audio id="alarmSound" loop>
      <source src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3" type="audio/mpeg">
    </audio>

    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="lib/createWaterBall-jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      // Global variables
      let isLoggedIn = false;
      let alarmActive = false;
      let alarmSound = document.getElementById('alarmSound');
      let alarmStates = [false, false, false, false];
      let alarmEnabled = [false, false, false, false];
      let tankLevels = [45, 65, 25, 85];
      let alarmThresholds = [90, 90, 90, 90];

      // Initialize the application
      $(document).ready(function() {
        // Show public dashboard by default
        showPublicDashboard();
        
        // Initialize water levels and alarms
        initializeTanks();
        
        // Set up event listeners
        setupEventListeners();
        
        // Start simulation of water level changes
        startWaterLevelSimulation();
      });

      // Function to get query string parameters
      function getQueryStringValue(key) {
        return decodeURIComponent(
          window.location.search.replace(
            new RegExp(
              "^(?:.*[&\\?]" +
                encodeURIComponent(key).replace(/[\.\+\*]/g, "\\$&") +
                "(?:\\=([^&]*))?)?.*$",
              "i"
            ),
            "$1"
          )
        );
      }

      // Initialize tanks with water levels
      function initializeTanks() {
        // Get tank values from URL parameters or use defaults
        tankLevels[0] = parseInt(getQueryStringValue("tank1")) || tankLevels[0];
        tankLevels[1] = parseInt(getQueryStringValue("tank2")) || tankLevels[1];
        tankLevels[2] = parseInt(getQueryStringValue("tank3")) || tankLevels[2];
        tankLevels[3] = parseInt(getQueryStringValue("tank4")) || tankLevels[3];

        // Initialize water balls for each tank
        $(".tank1").createWaterBall({
          targetRange: tankLevels[0]
        });
        
        $(".tank2").createWaterBall({
          targetRange: tankLevels[1]
        });
        
        $(".tank3").createWaterBall({
          targetRange: tankLevels[2]
        });
        
        $(".tank4").createWaterBall({
          targetRange: tankLevels[3]
        });

        // Set initial status text
        updateAllStatusText();
        
        // Initialize admin dashboard data
        updateAdminDashboard();
      }

      // Set up event listeners
      function setupEventListeners() {
        // Login form submission
        $('#loginFormElement').on('submit', function(e) {
          e.preventDefault();
          const username = $('#username').val();
          const password = $('#password').val();
          
          // Simple authentication (in a real app, this would be server-side)
          if (username === 'admin' && password === 'admin123') {
            isLoggedIn = true;
            showAdminDashboard();
          } else {
            alert('Invalid credentials. Try admin/admin123');
          }
        });
        
        // Show admin login from public dashboard
        $('#showAdminLogin').on('click', function() {
          showLoginForm();
        });
        
        // Show public dashboard from login form
        $('#showPublic').on('click', function() {
          showPublicDashboard();
        });
        
        // Logout button
        $('#logoutBtn').on('click', function() {
          isLoggedIn = false;
          showPublicDashboard();
        });
        
        // Alarm buttons
        for (let i = 1; i <= 4; i++) {
          $(`#alarmBtn${i}`).on('click', function() {
            toggleAlarm(i);
          });
          
          $(`#threshold${i}`).on('change', function() {
            alarmThresholds[i-1] = parseInt($(this).val());
            checkAlarmCondition(i);
          });
        }
      }

      // Toggle alarm for a specific tank
      function toggleAlarm(tankNumber) {
        const index = tankNumber - 1;
        alarmEnabled[index] = !alarmEnabled[index];
        
        const btn = $(`#alarmBtn${tankNumber}`);
        if (alarmEnabled[index]) {
          btn.text('Disable Alarm');
          btn.removeClass('muted');
          checkAlarmCondition(tankNumber);
        } else {
          btn.text('Enable Alarm');
          btn.addClass('muted');
          stopAlarm(tankNumber);
        }
        
        // Update admin dashboard
        updateAdminDashboard();
      }

      // Check if alarm should be triggered for a tank
      function checkAlarmCondition(tankNumber) {
        const index = tankNumber - 1;
        
        if (alarmEnabled[index] && tankLevels[index] >= alarmThresholds[index]) {
          if (!alarmStates[index]) {
            startAlarm(tankNumber);
          }
        } else {
          stopAlarm(tankNumber);
        }
      }

      // Start alarm for a specific tank
      function startAlarm(tankNumber) {
        const index = tankNumber - 1;
        alarmStates[index] = true;
        
        // Visual indicator
        $(`#tank${tankNumber}-card`).addClass('alarm-active');
        
        // Add alarm indicator
        if (!$(`#tank${tankNumber}-card .alarm-active-indicator`).length) {
          $(`#tank${tankNumber}-card`).append('<div class="alarm-active-indicator"></div>');
        }
        
        // Play sound if not already playing
        if (!alarmActive) {
          alarmSound.play().catch(e => {
            console.log("Audio play failed:", e);
          });
          alarmActive = true;
        }
        
        // Update admin dashboard
        updateAdminDashboard();
      }

      // Stop alarm for a specific tank
      function stopAlarm(tankNumber) {
        const index = tankNumber - 1;
        alarmStates[index] = false;
        
        // Remove visual indicators
        $(`#tank${tankNumber}-card`).removeClass('alarm-active');
        $(`#tank${tankNumber}-card .alarm-active-indicator`).remove();
        
        // Stop sound if no alarms are active
        if (alarmActive && alarmStates.every(state => !state)) {
          alarmSound.pause();
          alarmSound.currentTime = 0;
          alarmActive = false;
        }
        
        // Update admin dashboard
        updateAdminDashboard();
      }

      // Update status text for all tanks
      function updateAllStatusText() {
        for (let i = 1; i <= 4; i++) {
          updateStatusText(tankLevels[i-1], `status${i}`);
        }
      }

      // Update status text based on water levels
      function updateStatusText(level, elementId) {
        let statusText = "";
        let statusClass = "";
        
        if (level < 20) {
          statusText = "Danger - Low Level";
          statusClass = "text-danger";
        } else if (level < 40) {
          statusText = "Warning - Medium Level";
          statusClass = "text-warning";
        } else {
          statusText = "Safe - Good Level";
          statusClass = "text-success";
        }
        
        document.getElementById(elementId).innerHTML = `${level}% - ${statusText}`;
        document.getElementById(elementId).className = `tank-status ${statusClass}`;
      }

      // Update admin dashboard with current data
      function updateAdminDashboard() {
        if (!isLoggedIn) return;
        
        // Update tank levels and status
        for (let i = 1; i <= 4; i++) {
          const index = i - 1;
          $(`#adminTank${i}Level`).text(`${tankLevels[index]}%`);
          
          // Update status badges
          let statusBadge = '';
          if (tankLevels[index] < 20) {
            statusBadge = '<span class="status-badge danger">Critical</span>';
          } else if (tankLevels[index] < 40) {
            statusBadge = '<span class="status-badge warning">Warning</span>';
          } else {
            statusBadge = '<span class="status-badge success">Safe</span>';
          }
          $(`#adminTank${i}Status`).replaceWith(statusBadge);
          
          // Update alarm status
          const alarmStatus = alarmEnabled[index] 
            ? (alarmStates[index] 
                ? `<span class="status-badge danger">Active</span>` 
                : 'Enabled')
            : 'Disabled';
          $(`#adminTank${i}Alarm`).html(alarmStatus);
          
          // Update timestamp
          $(`#adminTank${i}Time`).text('Just now');
        }
        
        // Update statistics
        let safeCount = 0, warningCount = 0, criticalCount = 0;
        for (let i = 0; i < 4; i++) {
          if (tankLevels[i] < 20) criticalCount++;
          else if (tankLevels[i] < 40) warningCount++;
          else safeCount++;
        }
        
        $('#safeTanks').text(safeCount);
        $('#warningTanks').text(warningCount);
        $('#criticalTanks').text(criticalCount);
        
        // Update chart if it exists
        if (window.waterLevelChart) {
          updateChart();
        }
      }

      // Initialize chart for admin dashboard
      function initializeChart() {
        const ctx = document.getElementById('waterLevelChart').getContext('2d');
        window.waterLevelChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: ['1 min', '2 min', '3 min', '4 min', '5 min', 'Now'],
            datasets: [
              {
                label: 'Tank 1',
                data: [40, 42, 43, 44, 44, tankLevels[0]],
                borderColor: '#1a6fc4',
                backgroundColor: 'rgba(26, 111, 196, 0.1)',
                tension: 0.4
              },
              {
                label: 'Tank 2',
                data: [60, 62, 63, 64, 64, tankLevels[1]],
                borderColor: '#21b3b9',
                backgroundColor: 'rgba(33, 179, 185, 0.1)',
                tension: 0.4
              },
              {
                label: 'Tank 3',
                data: [20, 22, 23, 24, 24, tankLevels[2]],
                borderColor: '#ffb30c',
                backgroundColor: 'rgba(255, 179, 12, 0.1)',
                tension: 0.4
              },
              {
                label: 'Tank 4',
                data: [80, 82, 83, 84, 84, tankLevels[3]],
                borderColor: '#2ed351',
                backgroundColor: 'rgba(46, 211, 81, 0.1)',
                tension: 0.4
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                max: 100,
                title: {
                  display: true,
                  text: 'Water Level (%)'
                }
              }
            }
          }
        });
      }

      // Update chart data
      function updateChart() {
        if (!window.waterLevelChart) return;
        
        // Shift data left and add new values
        const datasets = window.waterLevelChart.data.datasets;
        for (let i = 0; i < datasets.length; i++) {
          // Remove first element and add new value at the end
          datasets[i].data.shift();
          datasets[i].data.push(tankLevels[i]);
        }
        
        window.waterLevelChart.update();
      }

      // Show login form
      function showLoginForm() {
        $('#loginForm').show();
        $('#publicDashboard').hide();
        $('#adminDashboard').hide();
        $('#mainFooter').hide();
      }

      // Show public dashboard
      function showPublicDashboard() {
        $('#loginForm').hide();
        $('#publicDashboard').show();
        $('#adminDashboard').hide();
        $('#mainFooter').show();
      }

      // Show admin dashboard
      function showAdminDashboard() {
        $('#loginForm').hide();
        $('#publicDashboard').hide();
        $('#adminDashboard').show();
        $('#mainFooter').show();
        
        // Initialize chart if not already done
        if (!window.waterLevelChart) {
          initializeChart();
        }
        
        // Update dashboard data
        updateAdminDashboard();
      }

      // Simulate water level changes for demo purposes
      function startWaterLevelSimulation() {
        setInterval(() => {
          // Randomly change water levels slightly
          for (let i = 0; i < 4; i++) {
            // Only change levels for demo if not using URL parameters
            if (!getQueryStringValue(`tank${i+1}`)) {
              const change = Math.random() * 4 - 2; // -2 to +2
              tankLevels[i] = Math.max(0, Math.min(100, tankLevels[i] + change));
              
              // Update water ball visualization
              $(`.tank${i+1}`).createWaterBall("updateRange", tankLevels[i]);
              
              // Update status text
              updateStatusText(tankLevels[i], `status${i+1}`);
              
              // Check alarm condition
              checkAlarmCondition(i+1);
            }
          }
          
          // Update admin dashboard if visible
          updateAdminDashboard();
        }, 3000);
      }
    </script>
  </body>
</html>